datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

enum user_role_t {
  user
  moderator
  admin
}

model SiteUser {
  id            String    @id @default(uuid()) @db.Uuid
  display_name  String    @unique
  avatar_url    String?   @db.Text
  bio           String?   @db.Text
  primary_wallet String?  @db.VarChar(128)
  role          user_role_t @default(user)
  is_banned     Boolean   @default(false)
  created_at    DateTime  @default(now()) @db.Timestamptz
  last_seen     DateTime? @db.Timestamptz

  wallets       Wallet[]
  flags         UserFlag[]

  @@map("site_users")
}

model Wallet {
  caip10_id  String   @id @db.VarChar(128)
  user_id    String   @db.Uuid
  label      String?  @db.VarChar(32)
  is_primary Boolean  @default(false)
  created_at DateTime @default(now()) @db.Timestamptz

  user SiteUser @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@index([user_id])
  @@map("wallets")
}

model UserFlag {
  user_id String  @db.Uuid
  flag    String  @db.VarChar(32)
  set_by  String? @db.Uuid
  set_at  DateTime @default(now()) @db.Timestamptz

  user SiteUser @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@id([user_id, flag])
  @@map("user_flags")
}
